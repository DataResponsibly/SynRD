<!DOCTYPE html>
<html>
  <head>
    <title>Interactive Heatmap</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  </head>
  <body>
    <div id="heatmap"></div>
    <object data="../../annotated_pdfs/who_gets_benefit_of_the_doubt_annotated.pdf#page=5" type="application/pdf" width="100%" height="500px">
      <p>Unable to display PDF file. <a href="../../annotated_pdfs/who_gets_benefit_of_the_doubt_annotated.pdf#page=5">Download</a> instead.</p>
    </object>

    <script>
        // Fetch the data
      const JSON = 'formatted_data.json';
        fetch('formatted_data.json')
  .then(response => response.json())
  .then(data => {
    console.log(data.columns.length)
    console.log( Array.from({ length: data.columns.length }, (_, i) => i + 1))
    // Prepare data for Plotly
    const trace = {
      z: data.data,
      x: [data.columns.map(col => col.split('-')[0]), data.columns.map(col => parseInt(col.split('-')[1]) + 1)],
      y: data.index,
      type: 'heatmap',
      hovertext: data.findings,
      hoverinfo: 'text',
      colorscale: [[0, '0C7BDC'], [1, 'FFC20A']],
      showscale: true,
      xgap: 1,
      ygap: 1,
    };

    // Generate the paper_to_finding_count map dynamically
    const paper_to_finding_count = {};
    for (const col of data.columns) {
      const [paper, _] = col.split('-');
      paper_to_finding_count[paper] = (paper_to_finding_count[paper] || 0) + 1;
    }

    // Prepare annotations for the paper names
    let annotations = [];
    let counter = 0;

    for (const paper of Object.keys(paper_to_finding_count)) {
      const occurrences = paper_to_finding_count[paper];

      annotations.push({
        x: counter + occurrences / 2 - 0.5,
        y: 0,
        xref: 'x',
        yref: 'paper',
        text: paper,
        showarrow: false,
        font: {
          size: 12,
        },
        yshift: -40 // Shift the annotation down
      });

      counter += occurrences;
    }

    // Layout configuration
    const layout = {
      title: 'Epistemic Parity',
      yaxis:{
        tickangle:270
      }
      // xaxis: {
      //   tickvals: Array.from({ length: data.columns.length }, (_, i) => i),
      //   ticktext: Array.from({ length: data.columns.length }, (_, i) => i + 1),
      // },
      // annotations: annotations,
    };

    const config = {
      responsive: true,
    };
    var myPlot = document.getElementById('heatmap');

    // Generate the plot
    Plotly.newPlot('heatmap', [trace], layout, config);
    myPlot.on('plotly_click', function(data){
      console.log(data);
    })
  });
//   Plotly.d3.json(JSON, function (rows) {
//   var myPlot = document.getElementById('heatmap');
//   myPlot.on('plotly_click', function(data){
//     console.log(data);
//   })
// });
      </script>
  </body>
</html>